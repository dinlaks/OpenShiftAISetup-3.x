apiVersion: v1
kind: Pod
metadata:
  name: test-pod-1
  namespace: test-efs-rwx
spec:
  containers:
  - name: app
    image: registry.access.redhat.com/ubi8/ubi-minimal:latest
    command: ["/bin/sh", "-c"]
    args:
    - |
      echo "========================================" | tee /data/test.txt
      echo "EFS RWX Storage Test - Pod 1" | tee -a /data/test.txt
      echo "========================================" | tee -a /data/test.txt
      echo "Hostname: \$(hostname)" | tee -a /data/test.txt
      echo "Time: \$(date)" | tee -a /data/test.txt
      echo "" | tee -a /data/test.txt
      echo "Creating test file..."
      dd if=/dev/zero of=/data/testfile.bin bs=1M count=10 2>&1 | tail -1 | tee -a /data/test.txt
      echo "" | tee -a /data/test.txt
      echo "Files in /data:" | tee -a /data/test.txt
      ls -lh /data/ | tee -a /data/test.txt
      echo "" | tee -a /data/test.txt
      echo "âœ… SUCCESS! Pod 1 can write to EFS!" | tee -a /data/test.txt
      echo ""
      echo "Pod running... (keeping alive for 1 hour)"
      sleep 3600
    volumeMounts:
    - name: storage
      mountPath: /data
  volumes:
  - name: storage
    persistentVolumeClaim:
      claimName: test-storage-1